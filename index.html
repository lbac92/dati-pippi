<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Generale P.I.P.P.I.</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <button class="menu-btn" onclick="toggleMenu()">☰</button>
    <div class="nav-overlay" id="navOverlay">
        <ul class="nav-links">
            <li><a href="index.html" onclick="toggleMenu()">Home</a></li>
            <li><a href="accoglienza.html" onclick="toggleMenu()">1. L'Accoglienza</a></li>
            <li><a href="cocostruzione.html" onclick="toggleMenu()">2. Co-Costruzione</a></li>
            <li><a href="dispositivi.html" onclick="toggleMenu()">3. I Dispositivi</a></li>
            <li><a href="strumenti.html" onclick="toggleMenu()">4. Gli Strumenti</a></li>
            <li style="margin-top: 40px;"><a href="#" onclick="toggleMenu()" style="font-size: 1rem; color: #999;">✕ Chiudi</a></li>
        </ul>
    </div>

    <div class="background-art"></div>

    <header class="hero">
        <div class="hero-content" data-aos="fade-down">
            <h1>Il Percorso P.I.P.P.I.</h1>
            <p>Tre edizioni di crescita, intrecci e supporto alla genitorialità.</p>
        </div>
    </header>

    <main class="container">

        <section data-aos="fade-up">
            <h2 style="text-align: center; margin-bottom: 40px; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">1. La Linea del Tempo</h2>
            
            <div class="timeline-wrapper">
                <div class="timeline-line"></div> 
                
                <div class="timeline-step">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content glass-effect">
                        <span class="timeline-title">P.I.P.P.I. 8</span>
                        <span class="timeline-year">2019 - 2021</span>
                        <hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">
                        <p><strong>10</strong> Famiglie (Livello Base)</p>
                        <p><strong>2</strong> Coach</p>
                    </div>
                </div>

                <div class="timeline-step">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content glass-effect">
                        <span class="timeline-title">P.I.P.P.I. 10</span>
                        <span class="timeline-year">2021 - 2023</span>
                        <hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">
                        <p><strong>22</strong> Famiglie (Livello Avanzato)</p>
                        <p><strong>2</strong> Coach | <strong>3</strong> Formatori</p>
                        <p style="color: #e67e22; font-weight: 600; margin-top:5px;">★ Attivazione Dispositivo Sostegno Genitorialità</p>
                    </div>
                </div>

                <div class="timeline-step">
                    <div class="timeline-dot"></div>
                    <div class="timeline-content glass-effect">
                        <span class="timeline-title">P.I.P.P.I. 12</span>
                        <span class="timeline-year">2023 - 2025</span>
                        <hr style="border: 0; border-top: 1px solid #ccc; margin: 10px 0;">
                        <p><strong>13</strong> Famiglie (Livello Avanzato)</p>
                        <p><strong>2</strong> Coach | <strong>3</strong> Formatori</p>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Dispositivo Sostegno Genitorialità</p>
                        <p style="color: #e67e22; font-weight: 600;">★ Gruppo di Lavoro Permanente</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="section-divider"></div>

        <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">2. I Protagonisti</h2>
        
        <div class="grid-2-col">
            <section class="card glass-effect" data-aos="fade-right">
                <div class="card-header">
                    <h2>Drop-out</h2>
                </div>
                <div style="display: flex; align-items: center; justify-content: center; height: 250px; flex-direction: column;">
                    <span style="font-size: 5rem; font-weight: bold; color: #e74c3c;">6</span>
                    <span style="font-size: 1.2rem; color: #555;">Famiglie uscite</span>
                    <small style="margin-top: 10px;">Su un totale di 45 (13.3%)</small>
                </div>
            </section>

            <section class="card glass-effect" data-aos="fade-left">
                <div class="card-header">
                    <h2>Chi sono le famiglie?</h2>
                </div>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="familyTypeChart"></canvas>
                </div>
            </section>
        </div>

        <section class="card glass-effect" data-aos="fade-up" style="margin-bottom: 40px;">
            <div class="card-header">
                <h2>Rete Territoriale Operatori</h2>
            </div>
            <div class="chart-container" style="height: 300px;">
                <canvas id="operatorsChart"></canvas>
            </div>
        </section>

        <div class="section-divider"></div>

        <h2 style="text-align: center; margin-bottom: 30px; color: #2c3e50;">3. Impatto e Fragilità</h2>

        <section class="card glass-effect" data-aos="fade-up" style="margin-bottom: 40px;">
            <div class="card-header">
                <h2>Aree di Fragilità Emerse</h2>
                <p>Percentuali calcolate sul totale delle famiglie che hanno concluso il percorso.</p>
            </div>
            
            <div class="chart-container" style="height: 300px;">
                <canvas id="fragilityChart"></canvas>
            </div>

            <button id="btnFragility" class="btn-expand" onclick="toggleFragility()">Vedi tutte le altre fragilità ▼</button>

            <div id="extraFragilityContainer" style="display: none;">
                <h3 style="text-align: center; font-size: 1rem; color: #666; margin-bottom: 15px;">Altre fragilità rilevate (Incidenza minore)</h3>
                <div class="chart-container" style="height: 400px;"> <canvas id="fragilitySecondaryChart"></canvas>
                </div>
            </div>
        </section>

        <section class="card glass-effect" data-aos="zoom-in">
            <div class="card-header" style="text-align: center;">
                <h2>Il Triangolo P.I.P.P.I. (Outcome)</h2>
                <p>Confronto punteggi medi: <span style="color:#e74c3c">■ Inizio (Pre)</span> vs <span style="color:#27ae60">■ Fine (Post)</span></p>
            </div>
            
            <div class="chart-container-large">
                <canvas id="pippiChart"></canvas>
            </div>
        </section>

    </main>

    <footer>
        <p>Progetto P.I.P.P.I. - Report Triennale</p>
    </footer>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="script.js"></script> 
    
    <script>
        AOS.init();
        Chart.defaults.font.family = "'Quicksand', sans-serif";
        Chart.defaults.font.size = 13;

        // --- FUNZIONE PER MOSTRARE/NASCONDERE FRAGILITÀ ---
        function toggleFragility() {
            var x = document.getElementById("extraFragilityContainer");
            var btn = document.getElementById("btnFragility");
            if (x.style.display === "none") {
                x.style.display = "block";
                btn.innerHTML = "Nascondi dettagli ▲";
            } else {
                x.style.display = "none";
                btn.innerHTML = "Vedi tutte le altre fragilità ▼";
            }
        }

        // 1. FAMIGLIE (Ciambella - DATI FITTIZI IN ATTESA)
        new Chart(document.getElementById('familyTypeChart'), {
            type: 'doughnut',
            data: {
                labels: ['Monogenitoriali', 'Nucleo completo', 'Famiglie ricostituite', 'Con affido'],
                datasets: [{
                    data: [15, 45, 10, 5],
                    backgroundColor: ['#3498db', '#2ecc71', '#f1c40f', '#9b59b6'],
                    borderWidth: 0
                }]
            },
            options: { 
                plugins: { 
                    legend: { position: 'bottom', labels: { padding: 20 } } 
                },
                maintainAspectRatio: false
            }
        });

        // 2. OPERATORI (DATI FITTIZI IN ATTESA)
        new Chart(document.getElementById('operatorsChart'), {
            type: 'bar',
            data: {
                labels: ['Servizi Sociali Comune', 'Consultorio Familiare', 'NPI', 'Terzo Settore', 'Scuola'],
                datasets: [{
                    label: 'Numero Operatori',
                    data: [12, 8, 5, 10, 3],
                    backgroundColor: '#34495e',
                    borderRadius: 4
                }]
            },
            options: { 
                indexAxis: 'y', 
                maintainAspectRatio: false,
                plugins: { legend: { display: false } }
            }
        });

        // 3a. FRAGILITA PRINCIPALI (Verticali - Dati Reali)
        new Chart(document.getElementById('fragilityChart'), {
            type: 'bar',
            data: {
                labels: ['Economica', 'Eventi Traumatici', 'Abitativa', 'Assenza Genitori', 'Disagio Psic. Bambino', 'Isolamento Sociale'],
                datasets: [{
                    label: '% Famiglie',
                    data: [51, 46, 42, 40, 40, 37],
                    backgroundColor: [
                        '#c0392b', '#c0392b', '#e74c3c', '#e74c3c', '#e74c3c', '#e74c3c'
                    ],
                    borderRadius: 5
                }]
            },
            options: { 
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, max: 60 } // Max un po' più alto del 51% per estetica
                }
            }
        });

        // 3b. FRAGILITA SECONDARIE (Orizzontali - Dati Reali)
        new Chart(document.getElementById('fragilitySecondaryChart'), {
            type: 'bar',
            data: {
                labels: [
                    'Disagio Psic. Famiglia', 'Bassa Scolarizzazione', 'Migrazione', 
                    'Incuria/Negligenza', 'Disabilità Bambino', 'Conflittualità Coppia', 
                    'Maltrattamento', 'Transgenerazionale', 'Altro'
                ],
                datasets: [{
                    label: '% Famiglie',
                    data: [34, 31, 23, 20, 20, 20, 11, 11, 9],
                    backgroundColor: '#3498db', // Blu per differenziare
                    borderRadius: 4,
                    barPercentage: 0.6
                }]
            },
            options: { 
                indexAxis: 'y', // Orizzontale
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { beginAtZero: true, max: 40 }
                }
            }
        });

        // 4. TRIANGOLO PIPPI (Confronto - DATI FITTIZI IN ATTESA)
        new Chart(document.getElementById('pippiChart'), {
            type: 'bar',
            data: {
                labels: [
                    'Risposta ai bisogni di sviluppo', 
                    'Relazioni familiari', 
                    'Relazioni sociali', 
                    'Salute e Sicurezza', 
                    'Scuola e Apprendimento'
                ],
                datasets: [
                    {
                        label: 'Inizio Percorso',
                        data: [3.5, 4.0, 2.5, 5.0, 3.2], 
                        backgroundColor: '#e74c3c', 
                        borderRadius: 4,
                        barPercentage: 0.6
                    },
                    {
                        label: 'Fine Percorso',
                        data: [7.2, 8.1, 6.5, 8.0, 7.5], 
                        backgroundColor: '#27ae60', 
                        borderRadius: 4,
                        barPercentage: 0.6
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                maintainAspectRatio: false,
                scales: {
                    x: { beginAtZero: true, max: 10 },
                    y: { grid: { display: false } }
                },
                plugins: { legend: { position: 'bottom' } }
            }
        });
    </script>

</body>
</html>